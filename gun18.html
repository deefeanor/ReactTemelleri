<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>React API Fetch</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        font-family: Arial;
        padding: 20px;
      }

      .light { background: #f5f5f5; color: black; }
      .dark { background: #222; color: white; }

      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 600px;
      }

      .dark .container { background: #333; }

      .done {
        text-decoration: line-through;
        color: gray;
      }

      .loading {
        font-weight: bold;
      }

      .error {
        color: red;
        font-weight: bold;
      }

      button { margin-right: 5px; }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      // Gün 18
      // Abdullah abi bugün gerçek API'den veri çektim.

      const DarkModeContext = React.createContext();

      function DarkModeProvider({ children }) {
        const [darkMode, setDarkMode] = React.useState(false);

        return (
          <DarkModeContext.Provider value={{ darkMode, setDarkMode }}>
            {children}
          </DarkModeContext.Provider>
        );
      }

      function taskReducer(state, action) {
        switch (action.type) {
          case "SET_TASKS":
            return action.payload;

          case "TOGGLE":
            return state.map((task, i) =>
              i === action.payload
                ? { ...task, completed: !task.completed }
                : task
            );

          default:
            return state;
        }
      }

      function Header() {
        const { darkMode, setDarkMode } =
          React.useContext(DarkModeContext);

        return (
          <>
            <h1>API'den Gelen Görevler</h1>
            <button onClick={() => setDarkMode(!darkMode)}>
              {darkMode ? "Light Mode" : "Dark Mode"}
            </button>
          </>
        );
      }

      function TaskItem({ task, index, dispatch }) {
        return (
          <li>
            <span
              className={task.completed ? "done" : ""}
              onClick={() =>
                dispatch({ type: "TOGGLE", payload: index })
              }
              style={{ cursor: "pointer" }}
            >
              {task.title}
            </span>
          </li>
        );
      }

      function App() {
        const { darkMode } = React.useContext(DarkModeContext);

        const [tasks, dispatch] = React.useReducer(taskReducer, []);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          async function fetchTasks() {
            try {
              const response = await fetch(
                "https://jsonplaceholder.typicode.com/todos?_limit=5"
              );

              if (!response.ok) {
                throw new Error("API hatası");
              }

              const data = await response.json();

              dispatch({ type: "SET_TASKS", payload: data });
            } catch (err) {
              setError("Veri alınamadı.");
            } finally {
              setLoading(false);
            }
          }

          fetchTasks();
        }, []);

        return (
          <div className={darkMode ? "dark" : "light"}>
            <div className="container">
              <Header />

              {loading && (
                <p className="loading">Veriler yükleniyor...</p>
              )}

              {error && <p className="error">{error}</p>}

              {!loading && !error && (
                <ul>
                  {tasks.map((task, index) => (
                    <TaskItem
                      key={task.id}
                      task={task}
                      index={index}
                      dispatch={dispatch}
                    />
                  ))}
                </ul>
              )}
            </div>
          </div>
        );
      }

      function Root() {
        return (
          <DarkModeProvider>
            <App />
          </DarkModeProvider>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<Root />);
    </script>
  </body>
</html>
